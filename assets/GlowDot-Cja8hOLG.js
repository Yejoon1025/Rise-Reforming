import{r as n,j as p}from"./index-DtGxoI7A.js";import{X as ct}from"./x-Pw--a_Ua.js";const je=n.createContext(null),lt="glowdots:allVisibleOpen",at="glowdots:openingStarted",ut="glowdots:openingFinished";function ht({children:G,threshold:K=.3}){const E=n.useRef(new Map),W=n.useRef(!1),_=n.useRef(!1),i=n.useCallback(()=>{const s=[];for(const[o,c]of E.current.entries())c?.isVisible&&s.push([o,c]);return s.sort(([o],[c])=>{const l=Number(o),d=Number(c),w=!Number.isNaN(l),Z=!Number.isNaN(d);return w&&Z?l-d:String(o).localeCompare(String(c))}),s},[]),N=n.useCallback(()=>i().length>0,[i]),$=n.useCallback(()=>{const s=i();return s.length?s.every(([,o])=>o.isOpen?.()):!1},[i]),Y=n.useCallback(()=>{const s=i();return s.length?s.some(([,o])=>!o.isOpen?.()):!1},[i]),O=n.useCallback(s=>{if(_.current)return;_.current=!0;const c=i().map(([l])=>l);typeof window<"u"&&window?.dispatchEvent&&window.dispatchEvent(new CustomEvent(at,{detail:{reason:s,visibleIds:c,timestamp:Date.now()}}))},[i]),Q=n.useCallback(s=>{if(typeof window<"u"&&window?.dispatchEvent){const c=i().map(([l])=>l);window.dispatchEvent(new CustomEvent(ut,{detail:{reason:s,visibleIds:c,timestamp:Date.now()}}))}_.current=!1},[i]),h=n.useCallback((s="unknown")=>{const o=i(),c=o.map(([w])=>w),l=o.length>0&&o.every(([,w])=>w.isOpen?.()),d=W.current;return!d&&l?(W.current=!0,typeof window<"u"&&window?.dispatchEvent&&window.dispatchEvent(new CustomEvent(lt,{detail:{reason:s,visibleIds:c,timestamp:Date.now()}})),Q(s),!0):(d&&!l&&(W.current=!1),!1)},[i,Q]),D=n.useCallback(()=>{const s=i();if(!s.length)return!1;s.some(([,l])=>!l.isOpen?.())&&O("openAllVisible");let c=!1;for(const[,l]of s)l.isOpen?.()||(l.open?.(),c=!0);return h("openAllVisible"),c},[i,O,h]),g=n.useCallback(()=>{const s=i();if(!s.length)return!1;const o=s.find(([,c])=>!c.isOpen?.());return o?(o[1].open?.(),h("openNextVisibleUnopened"),!0):!1},[i,h]),m=n.useRef({running:!1,timer:null}),F=1e3,R=1e3,S=n.useCallback(()=>{if(m.current.running)return;if(!Y()){h("sequence-skip-already-open");return}m.current.running=!0,O("sequence-start");const s=()=>{if(!g()||$()){m.current.running=!1,m.current.timer=null,h("sequence-finished");return}m.current.timer=setTimeout(s,R)};m.current.timer=setTimeout(s,F)},[Y,O,g,$,h]);n.useEffect(()=>()=>{m.current.timer&&clearTimeout(m.current.timer),m.current.running=!1,m.current.timer=null,_.current=!1},[]);const k=n.useCallback((s,o)=>{if(!s)return()=>{};const c=E.current.get(s)||{isVisible:!1};return E.current.set(s,{...c,...o}),h("register"),()=>{E.current.delete(s),h("unregister-cleanup")}},[h]),T=n.useCallback(s=>{E.current.delete(s),h("unregister")},[h]),P=n.useCallback((s,o)=>{if(!s)return;const c=N(),l=E.current.get(s)||{};E.current.set(s,{...l,isVisible:!!o});const d=N();!c&&d&&S(),h("visibility-change")},[N,S,h]),V=n.useCallback(()=>!1,[]),L=n.useCallback(()=>!1,[]),M=n.useCallback(()=>{},[]),H=n.useCallback(()=>!0,[]),J=n.useMemo(()=>({register:k,unregister:T,setVisible:P,hasVisibleDots:N,areAllVisibleOpen:$,openNextVisibleUnopened:g,openAllVisible:D,tryTriggerOpen:()=>{g()},presentOverlay:V,replaceOverlay:L,dismissOverlay:M,threshold:K,isProviderActive:H}),[k,T,P,N,$,g,D,V,L,M,K,H]);return p.jsx(je.Provider,{value:J,children:G})}function ft(){const G=n.useContext(je);if(!G)throw new Error("useGlowDotController must be used inside <GlowDotProvider>");return G}const mt=n.forwardRef(function(K,E){const{top:W="50%",left:_="50%",size:i=10,color:N="#3ca6a6",title:$,text:Y="Sample fact text goes here.",boxWidth:O=300,className:Q="",ariaLabel:h="Info dot",fadeMs:D=220,dotId:g,boxNumber:m,defaultSide:F="auto",defaultGap:R=24,viewportPadding:S=16,defaultOffsetX:k=null,defaultOffsetY:T=null,boundsRef:P=null,absolutePx:V=!1,absX:L=null,absY:M=null}=K,{register:H,setVisible:J,threshold:s}=ft(),o=n.useRef(null),c=n.useRef(null),[l,d]=n.useState(!1),[w,Z]=n.useState(!1),[xe,be]=n.useState(!1),[Ae,we]=n.useState(!1),[ee,ge]=n.useState(!1),[j,X]=n.useState({x:60,y:0}),ce=n.useRef(j);n.useEffect(()=>{ce.current=j},[j]);const[a,ve]=n.useState({w:O,h:0}),le=n.useRef(!1);function Ie(e){le.current=!0,d(t=>!t),e.preventDefault(),e.stopPropagation()}function _e(e){if(le.current){le.current=!1;return}}function $e(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),d(t=>!t))}const[Fe,ae]=n.useState(!1),ye=280,ue=n.useRef(l);n.useEffect(()=>{ue.current=l},[l]),n.useEffect(()=>{if(l)we(!1),Z(!0);else{be(!1);const e=setTimeout(()=>Z(!1),D),t=setTimeout(()=>ge(!1),D);return()=>{clearTimeout(e),clearTimeout(t)}}},[l,D]);function Ee(e){return typeof e=="number"?`${e}px`:e}const Se={top:Ee(W),left:Ee(_),width:`${i}px`,height:`${i}px`,transform:"translate(-50%, -50%)"};n.useLayoutEffect(()=>{if(!c.current)return;const e=c.current,t=new ResizeObserver(u=>{const f=u[0].contentRect;ve({w:f.width,h:f.height})});t.observe(e);const r=e.getBoundingClientRect();return ve({w:r.width,h:r.height}),()=>t.disconnect()},[w,O,Y]);function fe(){if(P?.current)return P.current.getBoundingClientRect();const e=o.current?.offsetParent;return e&&e instanceof HTMLElement?e.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight,right:window.innerWidth,bottom:window.innerHeight}}function de(){const e=o.current?.getBoundingClientRect();return e?{cx:e.left+e.width/2,cy:e.top+e.height/2}:null}function ze(){const e=window.innerWidth,t=window.innerHeight;return{left:0,top:0,right:e,bottom:t,width:e,height:t}}function Be(e,t){const r=Math.max(e.left,t.left),u=Math.max(e.top,t.top),f=Math.min(e.right??e.left+e.width,t.right??t.left+t.width),x=Math.min(e.bottom??e.top+e.height,t.bottom??t.top+t.height);return{left:r,top:u,right:f,bottom:x,width:Math.max(0,f-r),height:Math.max(0,x-u)}}function te(e,t){const r=de();if(!r)return{x:e,y:t};const u=fe(),f=ze(),x=Be(u,f);if(x.width===0||x.height===0)return{x:e,y:t};const v=x.left+S,q=x.top+S,A=x.right-S,I=x.bottom-S;let y=e,C=t;const b=r.cx+y-a.w/2,U=r.cy+C-a.h/2,re=b+a.w,ie=U+a.h;return b<v&&(y+=v-b),re>A&&(y-=re-A),U<q&&(C+=q-U),ie>I&&(C-=ie-I),{x:y,y:C}}function Ce(){const e=de();if(!e)return{x:60,y:0};const t=Number.isFinite(k),r=Number.isFinite(T);if(t||r)return te(t?k:0,r?T:0);const u=fe(),f=u.width??u.right-u.left,{cx:x}=e,v={right:{x:R+a.w/2+i/2,y:0},left:{x:-(R+a.w/2+i/2),y:0},top:{x:0,y:-(R+a.h/2+i/2)},bottom:{x:0,y:R+a.h/2+i/2}};function q(I){const{cx:y,cy:C}=de()||{cx:0,cy:0},b=fe(),U=b.left,re=b.top,ie=b.right??b.left+b.width,et=b.bottom??b.top+b.height,{x:tt,y:nt}=te(I.x,I.y),Pe=y+tt-a.w/2,Ve=C+nt-a.h/2,st=Pe+a.w,ot=Ve+a.h,rt=Math.max(0,Math.min(st,ie)-Math.max(Pe,U)),it=Math.max(0,Math.min(ot,et)-Math.max(Ve,re));return rt*it/(a.w*a.h+1e-6)}let A;if(F!=="auto")A=F;else{const y=x<u.left+f/2?["right","left","bottom","top"]:["left","right","bottom","top"];A=y.reduce((C,b)=>q(v[b])>q(v[C])?b:C,y[0])}return te(v[A].x,v[A].y)}n.useLayoutEffect(()=>{if(!w||ee)return;const e=()=>{if(a.w===0||a.h===0)return requestAnimationFrame(e);X(t=>{const r=Ce();return Math.abs(r.x-t.x)<.5&&Math.abs(r.y-t.y)<.5?t:r}),we(!0),requestAnimationFrame(()=>be(!0))};e()},[w,ee,a.w,a.h,F,R,S,P,k,T]),n.useEffect(()=>{if(!w||ee)return;const e=()=>{X(t=>{const r=Ce();return Math.abs(r.x-t.x)<.5&&Math.abs(r.y-t.y)<.5?t:r})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[w,ee,a.w,a.h,F,R,S,P,k,T]);const ne=n.useRef({on:!1,sx:0,sy:0,bx:0,by:0,frame:null,nx:0,ny:0});function Ne(e){const t=ne.current;t.on=!0,t.sx="touches"in e?e.touches[0].clientX:e.clientX,t.sy="touches"in e?e.touches[0].clientY:e.clientY,t.bx=ce.current.x,t.by=ce.current.y,t.nx=t.bx,t.ny=t.by,ae(!1),ge(!0),e.preventDefault(),e.stopPropagation()}function Ge(){const e=ne.current;e.frame||(e.frame=requestAnimationFrame(()=>{X({x:e.nx,y:e.ny}),e.frame=null}))}function se(e){const t=ne.current;if(!t.on)return;const r="touches"in e?e.touches[0].clientX:e.clientX,u="touches"in e?e.touches[0].clientY:e.clientY;t.nx=t.bx+(r-t.sx),t.ny=t.by+(u-t.sy),Ge(),e.preventDefault(),e.stopPropagation()}function oe(e){const t=ne.current;if(!t.on)return;t.on=!1,t.frame&&(cancelAnimationFrame(t.frame),t.frame=null),e?.stopPropagation?.();const r={x:t.nx,y:t.ny},u=te(r.x,r.y);Math.abs(u.x-r.x)>.5||Math.abs(u.y-r.y)>.5?(ae(!0),X(u),setTimeout(()=>ae(!1),ye)):X(r)}n.useEffect(()=>(window.addEventListener("mousemove",se),window.addEventListener("mouseup",oe),window.addEventListener("touchmove",se,{passive:!1}),window.addEventListener("touchend",oe),()=>{window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",oe),window.removeEventListener("touchmove",se),window.removeEventListener("touchend",oe)}),[]);const z={x:i/2,y:i/2},B={x:j.x+a.w/2,y:j.y+a.h/2},pe=Math.min(z.x,B.x),he=Math.min(z.y,B.y),Oe=Math.max(1,Math.abs(B.x-z.x)),Re=Math.max(1,Math.abs(B.y-z.y)),We=z.x-pe,Ye=z.y-he,He=B.x-pe,Xe=B.y-he,qe={backgroundColor:N},Ue={backgroundColor:N},Le=xe?"opacity-100":"opacity-0",Me={transition:`opacity ${D}ms ease`},De=Ae?{}:{opacity:0,visibility:"hidden"},Ke=xe?"pointer-events-auto":"pointer-events-none",Qe=Fe?{transition:`transform ${ye}ms cubic-bezier(0.2, 0.8, 0.2, 1)`}:{},[me,ke]=n.useState(null);function Je(){if(!(V&&Number.isFinite(L)&&Number.isFinite(M)))return null;const e=o.current?.offsetParent;if(e&&e instanceof HTMLElement){const t=e.getBoundingClientRect();return{left:L-t.left,top:M-t.top}}return{left:L,top:M}}n.useLayoutEffect(()=>{if(!(V&&Number.isFinite(L)&&Number.isFinite(M))){ke(null);return}const e=()=>ke(Je());e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,{passive:!0});const t=[],r=o.current?.offsetParent||o.current?.parentElement,u=x=>{if(!(x instanceof HTMLElement))return!1;const v=getComputedStyle(x);return/(auto|scroll)/.test(`${v.overflow}${v.overflowY}${v.overflowX}`)};let f=r;for(;f&&f!==document.body&&f!==document.documentElement;)u(f)&&(f.addEventListener("scroll",e,{passive:!0}),t.push(f)),f=f.parentElement;return()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e),t.forEach(x=>x.removeEventListener("scroll",e))}},[V,L,M]);const Ze=V&&me?{...Se,top:`${me.top}px`,left:`${me.left}px`}:Se,Te=m!=null&&String(m).length>0;return n.useImperativeHandle(E,()=>({open:()=>d(!0),close:()=>d(!1),isOpen:()=>ue.current}),[]),n.useEffect(()=>g?H(g,{open:()=>d(!0),close:()=>d(!1),isOpen:()=>ue.current,getRect:()=>o.current?.getBoundingClientRect()??null}):void 0,[g,H]),n.useEffect(()=>{if(!o.current||!g)return;const e=new IntersectionObserver(t=>{const r=t[0],u=r.isIntersecting&&r.intersectionRatio>=s;J(g,u)},{threshold:s});return e.observe(o.current),()=>e.disconnect()},[g,J,s]),p.jsxs("div",{ref:o,className:`absolute ${Q}`,style:Ze,children:[w&&p.jsx("svg",{className:`absolute pointer-events-none z-10 ${Le}`,style:{left:pe,top:he,width:Oe,height:Re,...Me,...De},viewBox:`0 0 ${Oe} ${Re}`,children:p.jsx("line",{x1:We,y1:Ye,x2:He,y2:Xe,stroke:"#374151",strokeWidth:"1.25",strokeLinecap:"round"})}),p.jsx("div",{className:"absolute -inset-2 rounded-full blur-md opacity-70 animate-pulse pointer-events-none z-20",style:Ue}),p.jsx("button",{type:"button",className:"absolute inset-0 rounded-full shadow-[0_0_6px_1px_rgba(0,0,0,0.25)] outline-none focus:outline-none z-30",style:qe,"aria-label":h,"aria-expanded":l,onMouseEnter:()=>d(!0),onFocus:()=>d(!0),onClick:_e,onTouchStart:Ie,onKeyDown:$e}),Te&&p.jsx("div",{className:"absolute left-1/2 top-full -translate-x-1/2 mt-1 z-40",children:p.jsx("span",{className:"inline-flex h-6 min-w-6 px-2 items-center justify-center rounded-full bg-[#0c1a22]/85 text-white/90 text-xs font-medium pointer-events-none",children:String(m)})}),w&&p.jsx("div",{ref:c,className:`absolute rounded-2xl bg-[#0c1a22]/85 text-white/90 cursor-move z-40 will-change-transform ${Le} ${Ke}`,style:{width:O,transform:`translate3d(${j.x}px, ${j.y}px, 0)`,...Me,...Qe,...De},onMouseDown:Ne,onTouchStart:Ne,children:p.jsxs("div",{className:"relative p-4 pt-3 pr-3",children:[p.jsx("button",{type:"button","aria-label":"Close textbox",className:"absolute top-2 right-2 inline-flex h-7 w-7 items-center justify-center rounded-md",style:{color:"#a9b3b8"},onClick:e=>{e.stopPropagation(),d(!1)},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:p.jsx(ct,{className:"h-4 w-4"})}),p.jsx("div",{className:"h-4"}),p.jsx("p",{className:"text-center text-base sm:text-lg md:text-xl lg:text-2xl leading-snug text-[#f8da9c]",children:$}),p.jsx("p",{className:"text-center text-base sm:text-lg md:text-xl lg:text-2xl leading-snug",children:Y}),Te&&p.jsx("div",{className:"absolute bottom-2 right-2 z-50 pointer-events-none",children:p.jsx("span",{className:"inline-flex h-5 min-w-5 px-1.5 items-center justify-center rounded-full bg-[#0c1a22]/90 text-white/90 text-[11px] font-medium leading-none",children:String(m)})})]})})]})});export{ht as G,at as a,ut as b,mt as c};
