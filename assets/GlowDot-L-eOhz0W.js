import{r as n,j as d}from"./index-BdNMoU2u.js";import{X as ce}from"./x-iV0it6Ny.js";const jt=n.createContext(null);function fe({children:A,threshold:W=.3}){const w=n.useRef(new Map),p=n.useCallback(()=>{const o=[];for(const[r,u]of w.current.entries())u?.isVisible&&o.push([r,u]);return o.sort(([r],[u])=>{const b=Number(r),P=Number(u),K=!Number.isNaN(b),G=!Number.isNaN(P);return K&&G?b-P:String(r).localeCompare(String(u))}),o},[]),R=n.useCallback(()=>p().length>0,[p]),h=n.useCallback(()=>{const o=p();return o.length?o.every(([,r])=>r.isOpen?.()):!1},[p]),Y=n.useCallback(()=>{const o=p();if(!o.length)return!1;let r=!1;for(const[,u]of o)u.isOpen?.()||(u.open?.(),r=!0);return r},[p]),N=n.useCallback(()=>{const o=p();if(!o.length)return!1;const r=o.find(([,u])=>!u.isOpen?.())||o[0];return r?(r[1].open?.(),!0):!1},[p]),m=n.useRef({running:!1,timer:null}),X=1e3,ot=1e3,q=n.useCallback(()=>{if(m.current.running)return;m.current.running=!0;const o=()=>{if(!N()||h()){m.current.running=!1,m.current.timer=null;return}m.current.timer=setTimeout(o,ot)};m.current.timer=setTimeout(o,X)},[N,h]);n.useEffect(()=>()=>{m.current.timer&&clearTimeout(m.current.timer),m.current.running=!1,m.current.timer=null},[]);const L=n.useCallback((o,r)=>{if(!o)return()=>{};const u=w.current.get(o)||{isVisible:!1};return w.current.set(o,{...u,...r}),()=>{w.current.delete(o)}},[]),y=n.useCallback(o=>{w.current.delete(o)},[]),D=n.useCallback((o,r)=>{if(!o)return;const u=R(),b=w.current.get(o)||{};w.current.set(o,{...b,isVisible:!!r});const P=R();!u&&P&&q()},[R,q]),O=n.useCallback(()=>!1,[]),v=n.useCallback(()=>!1,[]),E=n.useCallback(()=>{},[]),k=n.useCallback(()=>!0,[]),B=n.useMemo(()=>({register:L,unregister:y,setVisible:D,hasVisibleDots:R,areAllVisibleOpen:h,openNextVisibleUnopened:N,openAllVisible:Y,tryTriggerOpen:()=>{N()},presentOverlay:O,replaceOverlay:v,dismissOverlay:E,threshold:W,isProviderActive:k}),[L,y,D,R,h,N,Y,O,v,E,W,k]);return d.jsx(jt.Provider,{value:B,children:A})}function ue(){const A=n.useContext(jt);if(!A)throw new Error("useGlowDotController must be used inside <GlowDotProvider>");return A}const de=n.forwardRef(function(W,w){const{top:p="50%",left:R="50%",size:h=10,color:Y="#3ca6a6",title:N,text:m="Sample fact text goes here.",boxWidth:X=300,className:ot="",ariaLabel:q="Info dot",fadeMs:L=220,dotId:y,boxNumber:D,defaultSide:O="auto",defaultGap:v=24,viewportPadding:E=16,defaultOffsetX:k=null,defaultOffsetY:B=null,boundsRef:o=null,absolutePx:r=!1,absX:u=null,absY:b=null}=W,{register:P,setVisible:K,threshold:G}=ue(),S=n.useRef(null),rt=n.useRef(null),[F,C]=n.useState(!1),[T,xt]=n.useState(!1),[pt,bt]=n.useState(!1),[$t,gt]=n.useState(!1),[Q,wt]=n.useState(!1),[j,H]=n.useState({x:60,y:0}),it=n.useRef(j);n.useEffect(()=>{it.current=j},[j]);const[i,yt]=n.useState({w:X,h:0}),ct=n.useRef(!1);function zt(t){ct.current=!0,C(e=>!e),t.preventDefault(),t.stopPropagation()}function Bt(t){if(ct.current){ct.current=!1;return}}function Ft(t){(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),C(e=>!e))}const[Vt,ut]=n.useState(!1),vt=280,at=n.useRef(F);n.useEffect(()=>{at.current=F},[F]),n.useEffect(()=>{if(F)gt(!1),xt(!0);else{bt(!1);const t=setTimeout(()=>xt(!1),L),e=setTimeout(()=>wt(!1),L);return()=>{clearTimeout(t),clearTimeout(e)}}},[F,L]);function Et(t){return typeof t=="number"?`${t}px`:t}const St={top:Et(p),left:Et(R),width:`${h}px`,height:`${h}px`,transform:"translate(-50%, -50%)"};n.useLayoutEffect(()=>{if(!rt.current)return;const t=rt.current,e=new ResizeObserver(c=>{const a=c[0].contentRect;yt({w:a.width,h:a.height})});e.observe(t);const s=t.getBoundingClientRect();return yt({w:s.width,h:s.height}),()=>e.disconnect()},[T,X,m]);function lt(){if(o?.current)return o.current.getBoundingClientRect();const t=S.current?.offsetParent;return t&&t instanceof HTMLElement?t.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight,right:window.innerWidth,bottom:window.innerHeight}}function ft(){const t=S.current?.getBoundingClientRect();return t?{cx:t.left+t.width/2,cy:t.top+t.height/2}:null}function It(){const t=window.innerWidth,e=window.innerHeight;return{left:0,top:0,right:t,bottom:e,width:t,height:e}}function At(t,e){const s=Math.max(t.left,e.left),c=Math.max(t.top,e.top),a=Math.min(t.right??t.left+t.width,e.right??e.left+e.width),l=Math.min(t.bottom??t.top+t.height,e.bottom??e.top+e.height);return{left:s,top:c,right:a,bottom:l,width:Math.max(0,a-s),height:Math.max(0,l-c)}}function J(t,e){const s=ft();if(!s)return{x:t,y:e};const c=lt(),a=It(),l=At(c,a);if(l.width===0||l.height===0)return{x:t,y:e};const x=l.left+E,_=l.top+E,$=l.right-E,z=l.bottom-E;let g=t,M=e;const f=s.cx+g-i.w/2,U=s.cy+M-i.h/2,nt=f+i.w,st=U+i.h;return f<x&&(g+=x-f),nt>$&&(g-=nt-$),U<_&&(M+=_-U),st>z&&(M-=st-z),{x:g,y:M}}function Ct(){const t=ft();if(!t)return{x:60,y:0};const e=Number.isFinite(k),s=Number.isFinite(B);if(e||s)return J(e?k:0,s?B:0);const c=lt(),a=c.width??c.right-c.left,{cx:l}=t,x={right:{x:v+i.w/2+h/2,y:0},left:{x:-(v+i.w/2+h/2),y:0},top:{x:0,y:-(v+i.h/2+h/2)},bottom:{x:0,y:v+i.h/2+h/2}};function _(z){const{cx:g,cy:M}=ft()||{cx:0,cy:0},f=lt(),U=f.left,nt=f.top,st=f.right??f.left+f.width,te=f.bottom??f.top+f.height,{x:ee,y:ne}=J(z.x,z.y),Pt=g+ee-i.w/2,Tt=M+ne-i.h/2,se=Pt+i.w,oe=Tt+i.h,re=Math.max(0,Math.min(se,st)-Math.max(Pt,U)),ie=Math.max(0,Math.min(oe,te)-Math.max(Tt,nt));return re*ie/(i.w*i.h+1e-6)}let $;if(O!=="auto")$=O;else{const g=l<c.left+a/2?["right","left","bottom","top"]:["left","right","bottom","top"];$=g.reduce((M,f)=>_(x[f])>_(x[M])?f:M,g[0])}return J(x[$].x,x[$].y)}n.useLayoutEffect(()=>{if(!T||Q)return;const t=()=>{if(i.w===0||i.h===0)return requestAnimationFrame(t);H(e=>{const s=Ct();return Math.abs(s.x-e.x)<.5&&Math.abs(s.y-e.y)<.5?e:s}),gt(!0),requestAnimationFrame(()=>bt(!0))};t()},[T,Q,i.w,i.h,O,v,E,o,k,B]),n.useEffect(()=>{if(!T||Q)return;const t=()=>{H(e=>{const s=Ct();return Math.abs(s.x-e.x)<.5&&Math.abs(s.y-e.y)<.5?e:s})};return window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[T,Q,i.w,i.h,O,v,E,o,k,B]);const Z=n.useRef({on:!1,sx:0,sy:0,bx:0,by:0,frame:null,nx:0,ny:0});function Mt(t){const e=Z.current;e.on=!0,e.sx="touches"in t?t.touches[0].clientX:t.clientX,e.sy="touches"in t?t.touches[0].clientY:t.clientY,e.bx=it.current.x,e.by=it.current.y,e.nx=e.bx,e.ny=e.by,ut(!1),wt(!0),t.preventDefault(),t.stopPropagation()}function Yt(){const t=Z.current;t.frame||(t.frame=requestAnimationFrame(()=>{H({x:t.nx,y:t.ny}),t.frame=null}))}function tt(t){const e=Z.current;if(!e.on)return;const s="touches"in t?t.touches[0].clientX:t.clientX,c="touches"in t?t.touches[0].clientY:t.clientY;e.nx=e.bx+(s-e.sx),e.ny=e.by+(c-e.sy),Yt(),t.preventDefault(),t.stopPropagation()}function et(t){const e=Z.current;if(!e.on)return;e.on=!1,e.frame&&(cancelAnimationFrame(e.frame),e.frame=null),t?.stopPropagation?.();const s={x:e.nx,y:e.ny},c=J(s.x,s.y);Math.abs(c.x-s.x)>.5||Math.abs(c.y-s.y)>.5?(ut(!0),H(c),setTimeout(()=>ut(!1),vt)):H(s)}n.useEffect(()=>(window.addEventListener("mousemove",tt),window.addEventListener("mouseup",et),window.addEventListener("touchmove",tt,{passive:!1}),window.addEventListener("touchend",et),()=>{window.removeEventListener("mousemove",tt),window.removeEventListener("mouseup",et),window.removeEventListener("touchmove",tt),window.removeEventListener("touchend",et)}),[]);const V={x:h/2,y:h/2},I={x:j.x+i.w/2,y:j.y+i.h/2},dt=Math.min(V.x,I.x),ht=Math.min(V.y,I.y),Rt=Math.max(1,Math.abs(I.x-V.x)),Nt=Math.max(1,Math.abs(I.y-V.y)),Xt=V.x-dt,Gt=V.y-ht,Ht=I.x-dt,_t=I.y-ht,Ut={backgroundColor:Y},Wt={backgroundColor:Y},Lt=pt?"opacity-100":"opacity-0",Dt={transition:`opacity ${L}ms ease`},Ot=$t?{}:{opacity:0,visibility:"hidden"},qt=pt?"pointer-events-auto":"pointer-events-none",Kt=Vt?{transition:`transform ${vt}ms cubic-bezier(0.2, 0.8, 0.2, 1)`}:{},[mt,kt]=n.useState(null);function Qt(){if(!(r&&Number.isFinite(u)&&Number.isFinite(b)))return null;const t=S.current?.offsetParent;if(t&&t instanceof HTMLElement){const e=t.getBoundingClientRect();return{left:u-e.left,top:b-e.top}}return{left:u,top:b}}n.useLayoutEffect(()=>{if(!(r&&Number.isFinite(u)&&Number.isFinite(b))){kt(null);return}const t=()=>kt(Qt());t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,{passive:!0});const e=[],s=S.current?.offsetParent||S.current?.parentElement,c=l=>{if(!(l instanceof HTMLElement))return!1;const x=getComputedStyle(l);return/(auto|scroll)/.test(`${x.overflow}${x.overflowY}${x.overflowX}`)};let a=s;for(;a&&a!==document.body&&a!==document.documentElement;)c(a)&&(a.addEventListener("scroll",t,{passive:!0}),e.push(a)),a=a.parentElement;return()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t),e.forEach(l=>l.removeEventListener("scroll",t))}},[r,u,b]);const Jt=r&&mt?{...St,top:`${mt.top}px`,left:`${mt.left}px`}:St,Zt=D!=null&&String(D).length>0;return n.useImperativeHandle(w,()=>({open:()=>C(!0),close:()=>C(!1),isOpen:()=>at.current}),[]),n.useEffect(()=>y?P(y,{open:()=>C(!0),close:()=>C(!1),isOpen:()=>at.current,getRect:()=>S.current?.getBoundingClientRect()??null}):void 0,[y,P]),n.useEffect(()=>{if(!S.current||!y)return;const t=new IntersectionObserver(e=>{const s=e[0],c=s.isIntersecting&&s.intersectionRatio>=G;K(y,c)},{threshold:G});return t.observe(S.current),()=>t.disconnect()},[y,K,G]),d.jsxs("div",{ref:S,className:`absolute ${ot}`,style:Jt,children:[T&&d.jsx("svg",{className:`absolute pointer-events-none z-10 ${Lt}`,style:{left:dt,top:ht,width:Rt,height:Nt,...Dt,...Ot},viewBox:`0 0 ${Rt} ${Nt}`,children:d.jsx("line",{x1:Xt,y1:Gt,x2:Ht,y2:_t,stroke:"#374151",strokeWidth:"1.25",strokeLinecap:"round"})}),d.jsx("div",{className:"absolute -inset-2 rounded-full blur-md opacity-70 animate-pulse pointer-events-none z-20",style:Wt}),d.jsx("button",{type:"button",className:"absolute inset-0 rounded-full shadow-[0_0_6px_1px_rgba(0,0,0,0.25)] outline-none focus:outline-none z-30",style:Ut,"aria-label":q,"aria-expanded":F,onMouseEnter:()=>C(!0),onFocus:()=>C(!0),onClick:Bt,onTouchStart:zt,onKeyDown:Ft}),Zt&&d.jsx("div",{className:"absolute left-1/2 top-full -translate-x-1/2 mt-1 z-40",children:d.jsx("span",{className:"inline-flex h-6 min-w-6 px-2 items-center justify-center rounded-full bg-[#0c1a22]/85 text-white/90 text-xs font-medium pointer-events-none",children:String(D)})}),T&&d.jsx("div",{ref:rt,className:`absolute rounded-2xl bg-[#0c1a22]/85 text-white/90 cursor-move z-40 will-change-transform ${Lt} ${qt}`,style:{width:X,transform:`translate3d(${j.x}px, ${j.y}px, 0)`,...Dt,...Kt,...Ot},onMouseDown:Mt,onTouchStart:Mt,children:d.jsxs("div",{className:"relative p-4 pt-3 pr-3",children:[d.jsx("button",{type:"button","aria-label":"Close textbox",className:"absolute top-2 right-2 inline-flex h-7 w-7 items-center justify-center rounded-md",style:{color:"#a9b3b8"},onClick:t=>{t.stopPropagation(),C(!1)},onMouseDown:t=>t.stopPropagation(),onTouchStart:t=>t.stopPropagation(),children:d.jsx(ce,{className:"h-4 w-4"})}),d.jsx("div",{className:"h-4"}),d.jsx("p",{className:"text-center text-base sm:text-lg md:text-xl lg:text-2xl leading-snug text-[#f8da9c]",children:N}),d.jsx("p",{className:"text-center text-base sm:text-lg md:text-xl lg:text-2xl leading-snug",children:m})]})})]})});export{fe as G,de as a};
